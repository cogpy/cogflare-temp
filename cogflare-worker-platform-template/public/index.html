<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Hyperdrive PostgreSQL Manager</title>
		<link rel="stylesheet" href="styles.css" />
	</head>
	<body>
		<div class="container">
			<header>
				<div class="logo-container">
					<h1 class="logo">
						<a href="https://developers.cloudflare.com/hyperdrive/"
							>HYPERDRIVE</a
						>
					</h1>
					<span class="subtitle">PostgreSQL Manager</span>
				</div>
			</header>
			<div class="description">
				<a href="https://developers.cloudflare.com/hyperdrive">Hyperdrive</a>
				accelerates the queries you make to your PostgreSQL or MySQL databases,
				making it faster to access your data from across the planet, no matter
				where your users are. Learn more about
				<a
					href="https://developers.cloudflare.com/hyperdrive/configuration/how-hyperdrive-works/"
					>how Hyperdrive works</a
				>
				and check out the performance
				<a href="https://hyperdrive-demo.pages.dev/">demo</a>.

				<br />
				<br />

				If your values aren't updating when you make changes, you likely have
				caching enabled on your Hyperdrive configuration. Hyperdrive's
				<a href="disable caching">built-in caching</a> allows you to serve high
				throughput of requests with low latency for requests that don't need
				updated values. You can
				<a
					href="https://developers.cloudflare.com/hyperdrive/configuration/query-caching/"
					>disable caching</a
				>
				in your Hyperdrive configuration from the dashboard or using the
				Wrangler CLI to get most up-to-date values.
			</div>
			<main>
				<!-- Loading View -->
				<div id="loadingView">
					<div class="loading-container">
						<div class="spinner"></div>
						<p>Connecting to database...</p>
					</div>
				</div>

				<!-- Initialize View -->
				<div id="initializeView" class="hidden">
					<div class="empty-state">
						<div class="empty-icon">☁️</div>
						<h2>Welcome to PostgreSQL Hyperdrive Manager</h2>
						<p>
							No tables found. Click the button below to initialize the database
							with Users and Organizations tables.
						</p>
						<button id="initializeTablesBtn" class="btn primary">
							Initialize Tables
						</button>
					</div>
				</div>

				<!-- Tables Dashboard View -->
				<div id="dashboardView" class="hidden">
					<div class="tabs">
						<button class="tab-btn active" id="usersTabBtn">Users</button>
						<button class="tab-btn" id="orgsTabBtn">Organizations</button>
					</div>

					<!-- Users Tab -->
					<div class="tab-content" id="usersTab">
						<div class="action-bar">
							<div class="filter-container">
								<label for="orgFilter">Filter by Organization:</label>
								<select id="orgFilter">
									<option value="">All Organizations</option>
									<!-- Organizations will be added here -->
								</select>
							</div>
							<button class="btn primary" id="addUserBtn">+ Add User</button>
						</div>

						<div class="card">
							<div class="table-container">
								<table id="usersTable">
									<thead>
										<tr>
											<th>ID</th>
											<th>Username</th>
											<th>Organization</th>
											<th>Created At</th>
											<th>Updated At</th>
											<th>Actions</th>
										</tr>
									</thead>
									<tbody id="usersTableBody">
										<!-- User rows will be inserted here -->
									</tbody>
								</table>
							</div>
						</div>
					</div>

					<!-- Organizations Tab -->
					<div class="tab-content hidden" id="orgsTab">
						<div class="action-bar">
							<button class="btn primary" id="addOrgBtn">
								+ Add Organization
							</button>
						</div>

						<div class="card">
							<div class="table-container">
								<table id="orgsTable">
									<thead>
										<tr>
											<th>ID</th>
											<th>Name</th>
											<th>Created At</th>
											<th>Updated At</th>
											<th>Actions</th>
										</tr>
									</thead>
									<tbody id="orgsTableBody">
										<!-- Organization rows will be inserted here -->
									</tbody>
								</table>
							</div>
						</div>
					</div>
				</div>
			</main>
		</div>

		<!-- Add/Edit Organization Modal -->
		<div id="orgModal" class="modal">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="orgModalTitle">Add Organization</h5>
					<button type="button" class="close-btn" data-dismiss="orgModal">
						&times;
					</button>
				</div>
				<div class="modal-body">
					<form id="orgForm">
						<div class="form-group">
							<label for="orgName">Organization Name</label>
							<input type="text" id="orgName" required />
							<div class="error-message" id="orgNameError"></div>
						</div>
					</form>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn secondary" data-dismiss="orgModal">
						Cancel
					</button>
					<button type="button" class="btn primary" id="saveOrgBtn">
						Save
					</button>
				</div>
			</div>
		</div>

		<!-- Add/Edit User Modal -->
		<div id="userModal" class="modal">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="userModalTitle">Add User</h5>
					<button type="button" class="close-btn" data-dismiss="userModal">
						&times;
					</button>
				</div>
				<div class="modal-body">
					<form id="userForm">
						<input type="hidden" id="userId" />
						<div class="form-group">
							<label for="username">Username</label>
							<input type="text" id="username" required />
							<div class="error-message" id="usernameError"></div>
						</div>
						<div class="form-group">
							<label for="userOrg">Organization</label>
							<select id="userOrg">
								<option value="">None</option>
								<!-- Organizations will be added here -->
							</select>
						</div>
					</form>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn secondary" data-dismiss="userModal">
						Cancel
					</button>
					<button type="button" class="btn primary" id="saveUserBtn">
						Save
					</button>
				</div>
			</div>
		</div>

		<!-- Confirm Delete Modal -->
		<div id="confirmDeleteModal" class="modal">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title">Confirm Delete</h5>
					<button
						type="button"
						class="close-btn"
						data-dismiss="confirmDeleteModal"
					>
						&times;
					</button>
				</div>
				<div class="modal-body">
					<p id="confirmDeleteMessage">
						Are you sure you want to delete this item?
					</p>
				</div>
				<div class="modal-footer">
					<button
						type="button"
						class="btn secondary"
						data-dismiss="confirmDeleteModal"
					>
						Cancel
					</button>
					<button type="button" class="btn danger" id="confirmDeleteBtn">
						Delete
					</button>
				</div>
			</div>
		</div>

		<!-- Toast Notifications -->
		<div class="toast-container">
			<div id="toastNotification" class="toast">
				<div class="toast-content">
					<div id="toastMessage"></div>
					<button type="button" class="close-btn" data-dismiss="toast">
						&times;
					</button>
				</div>
			</div>
		</div>

		<script type="module" src="js/app.js"></script>
	</body>
</html>


================================================================================
Content from: index (2).html
================================================================================

<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>NLWeb Chat</title>
		<link rel="stylesheet" href="/common-chat-styles.css" />
		<link rel="stylesheet" href="/chat-page-styles.css" />
	</head>
	<body>
		<div class="app-container">
			<!-- Mobile Menu Toggle -->
			<button class="mobile-menu-toggle" id="mobile-menu-toggle">
				<svg
					width="24"
					height="24"
					viewBox="0 0 24 24"
					fill="none"
					stroke="currentColor"
					stroke-width="2"
				>
					<line x1="3" y1="12" x2="21" y2="12"></line>
					<line x1="3" y1="6" x2="21" y2="6"></line>
					<line x1="3" y1="18" x2="21" y2="18"></line>
				</svg>
			</button>

			<!-- Sidebar Toggle Button (outside sidebar) -->
			<button class="sidebar-toggle" id="sidebar-toggle" title="Toggle sidebar">
				<svg
					viewBox="0 0 24 24"
					fill="none"
					stroke="currentColor"
					stroke-width="2"
				>
					<polyline points="15 18 9 12 15 6"></polyline>
				</svg>
			</button>

			<!-- Sidebar -->
			<aside class="sidebar" id="sidebar">
				<div class="sidebar-header">
					<!-- Conversations header with new button -->
					<div class="conversations-header">
						<h2 class="conversations-title">Conversations</h2>
						<button
							class="new-chat-icon-btn"
							id="new-chat-btn"
							title="New chat"
						>
							<span class="plus-icon">+</span>
						</button>
					</div>
				</div>

				<!-- Conversations list -->
				<div class="conversations-list" id="conversations-list">
					<!-- Conversation items will be dynamically added here -->
				</div>
			</aside>

			<!-- Main Chat Area -->
			<main class="main-content">
				<header class="chat-header">
					<h1 class="chat-title">New chat</h1>
					<span class="chat-site-info" id="chat-site-info">Asking all</span>
				</header>

				<div class="chat-messages" id="chat-messages">
					<div class="messages-container" id="messages-container">
						<!-- Messages will be dynamically added here -->
					</div>
				</div>

				<div class="chat-input-container">
					<div class="chat-input-wrapper">
						<div class="chat-input-box">
							<div class="input-mode-selector">
								<button
									class="mode-selector-icon"
									id="mode-selector-icon"
									title="Select mode"
								>
									<svg
										viewBox="0 0 24 24"
										fill="none"
										stroke="currentColor"
										stroke-width="2"
									>
										<rect
											x="3"
											y="3"
											width="18"
											height="18"
											rx="2"
											ry="2"
										></rect>
										<line x1="9" y1="9" x2="15" y2="9"></line>
										<line x1="9" y1="12" x2="15" y2="12"></line>
										<line x1="9" y1="15" x2="11" y2="15"></line>
									</svg>
								</button>
								<div class="mode-dropdown" id="mode-dropdown">
									<div class="mode-dropdown-header">Select mode</div>
									<div class="mode-dropdown-item" data-mode="list">List</div>
									<div class="mode-dropdown-item" data-mode="summarize">
										Summarize
									</div>
									<div class="mode-dropdown-item" data-mode="generate">
										Generate
									</div>
								</div>
							</div>
							<textarea
								class="chat-input"
								id="chat-input"
								placeholder="Send a message..."
								rows="1"
							></textarea>
							<button class="send-button" id="send-button">
								<svg
									viewBox="0 0 24 24"
									fill="none"
									stroke="currentColor"
									stroke-width="2"
								>
									<line x1="22" y1="2" x2="11" y2="13"></line>
									<polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
								</svg>
								Send
							</button>
						</div>
					</div>
				</div>
			</main>
		</div>

		<script type="module" src="/fp-chat-interface.js"></script>
	</body>
</html>


================================================================================
Content from: index (3).html
================================================================================

<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Hyperdrive MySQL Manager</title>
		<link rel="stylesheet" href="styles.css" />
	</head>
	<body>
		<div class="container">
			<header>
				<div class="logo-container">
					<h1 class="logo">
						<a href="https://developers.cloudflare.com/hyperdrive/"
							>HYPERDRIVE</a
						>
					</h1>
					<span class="subtitle">MySQL Manager</span>
				</div>
			</header>
			<div class="description">
				<a href="https://developers.cloudflare.com/hyperdrive">Hyperdrive</a>
				accelerates the queries you make to your PostgreSQL or MySQL databases,
				making it faster to access your data from across the planet, no matter
				where your users are. Learn more about
				<a
					href="https://developers.cloudflare.com/hyperdrive/configuration/how-hyperdrive-works/"
					>how Hyperdrive works</a
				>
				and check out the performance
				<a href="https://hyperdrive-demo.pages.dev/">demo</a>.

				<br />
				<br />

				If your values aren't updating when you make changes, you likely have
				caching enabled on your Hyperdrive configuration. Hyperdrive's
				<a href="disable caching">built-in caching</a> allows you to serve high
				throughput of requests with low latency for requests that don't need
				updated values. You can
				<a
					href="https://developers.cloudflare.com/hyperdrive/configuration/query-caching/"
					>disable caching</a
				>
				in your Hyperdrive configuration from the dashboard or using the
				Wrangler CLI to get most up-to-date values.
			</div>
			<main>
				<!-- Loading View -->
				<div id="loadingView">
					<div class="loading-container">
						<div class="spinner"></div>
						<p>Connecting to database...</p>
					</div>
				</div>

				<!-- Initialize View -->
				<div id="initializeView" class="hidden">
					<div class="empty-state">
						<div class="empty-icon">☁️</div>
						<h2>Welcome to MySQL Hyperdrive Manager</h2>
						<p>
							No tables found. Click the button below to initialize the database
							with Users and Organizations tables.
						</p>
						<button id="initializeTablesBtn" class="btn primary">
							Initialize Tables
						</button>
					</div>
				</div>

				<!-- Tables Dashboard View -->
				<div id="dashboardView" class="hidden">
					<div class="tabs">
						<button class="tab-btn active" id="usersTabBtn">Users</button>
						<button class="tab-btn" id="orgsTabBtn">Organizations</button>
					</div>

					<!-- Users Tab -->
					<div class="tab-content" id="usersTab">
						<div class="action-bar">
							<div class="filter-container">
								<label for="orgFilter">Filter by Organization:</label>
								<select id="orgFilter">
									<option value="">All Organizations</option>
									<!-- Organizations will be added here -->
								</select>
							</div>
							<button class="btn primary" id="addUserBtn">+ Add User</button>
						</div>

						<div class="card">
							<div class="table-container">
								<table id="usersTable">
									<thead>
										<tr>
											<th>ID</th>
											<th>Username</th>
											<th>Organization</th>
											<th>Created At</th>
											<th>Updated At</th>
											<th>Actions</th>
										</tr>
									</thead>
									<tbody id="usersTableBody">
										<!-- User rows will be inserted here -->
									</tbody>
								</table>
							</div>
						</div>
					</div>

					<!-- Organizations Tab -->
					<div class="tab-content hidden" id="orgsTab">
						<div class="action-bar">
							<button class="btn primary" id="addOrgBtn">
								+ Add Organization
							</button>
						</div>

						<div class="card">
							<div class="table-container">
								<table id="orgsTable">
									<thead>
										<tr>
											<th>ID</th>
											<th>Name</th>
											<th>Created At</th>
											<th>Updated At</th>
											<th>Actions</th>
										</tr>
									</thead>
									<tbody id="orgsTableBody">
										<!-- Organization rows will be inserted here -->
									</tbody>
								</table>
							</div>
						</div>
					</div>
				</div>
			</main>
		</div>

		<!-- Add/Edit Organization Modal -->
		<div id="orgModal" class="modal">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="orgModalTitle">Add Organization</h5>
					<button type="button" class="close-btn" data-dismiss="orgModal">
						&times;
					</button>
				</div>
				<div class="modal-body">
					<form id="orgForm">
						<div class="form-group">
							<label for="orgName">Organization Name</label>
							<input type="text" id="orgName" required />
							<div class="error-message" id="orgNameError"></div>
						</div>
					</form>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn secondary" data-dismiss="orgModal">
						Cancel
					</button>
					<button type="button" class="btn primary" id="saveOrgBtn">
						Save
					</button>
				</div>
			</div>
		</div>

		<!-- Add/Edit User Modal -->
		<div id="userModal" class="modal">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="userModalTitle">Add User</h5>
					<button type="button" class="close-btn" data-dismiss="userModal">
						&times;
					</button>
				</div>
				<div class="modal-body">
					<form id="userForm">
						<input type="hidden" id="userId" />
						<div class="form-group">
							<label for="username">Username</label>
							<input type="text" id="username" required />
							<div class="error-message" id="usernameError"></div>
						</div>
						<div class="form-group">
							<label for="userOrg">Organization</label>
							<select id="userOrg">
								<option value="">None</option>
								<!-- Organizations will be added here -->
							</select>
						</div>
					</form>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn secondary" data-dismiss="userModal">
						Cancel
					</button>
					<button type="button" class="btn primary" id="saveUserBtn">
						Save
					</button>
				</div>
			</div>
		</div>

		<!-- Confirm Delete Modal -->
		<div id="confirmDeleteModal" class="modal">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title">Confirm Delete</h5>
					<button
						type="button"
						class="close-btn"
						data-dismiss="confirmDeleteModal"
					>
						&times;
					</button>
				</div>
				<div class="modal-body">
					<p id="confirmDeleteMessage">
						Are you sure you want to delete this item?
					</p>
				</div>
				<div class="modal-footer">
					<button
						type="button"
						class="btn secondary"
						data-dismiss="confirmDeleteModal"
					>
						Cancel
					</button>
					<button type="button" class="btn danger" id="confirmDeleteBtn">
						Delete
					</button>
				</div>
			</div>
		</div>

		<!-- Toast Notifications -->
		<div class="toast-container">
			<div id="toastNotification" class="toast">
				<div class="toast-content">
					<div id="toastMessage"></div>
					<button type="button" class="close-btn" data-dismiss="toast">
						&times;
					</button>
				</div>
			</div>
		</div>

		<script type="module" src="js/app.js"></script>
	</body>
</html>


================================================================================
Content from: index (4).html
================================================================================

<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta
			name="viewport"
			content="width=device-width, initial-scale=1.0, shrink-to-fit=no"
		/>
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<title>Globe</title>
		<!-- Favicon -->
		<link rel="icon" href="/favicon.ico" sizes="any" />
		<!-- Primary Meta Tags -->
		<meta name="title" content="PartyServer" />
		<meta name="description" content="Everything's better with friends!" />
		<meta name="author" content="PartyServer" />
		<!-- Theme Colour -->
		<meta name="theme-color" content="#ffffff" />

		<link rel="stylesheet" href="/normalize.css" />
		<link rel="stylesheet" href="/dist/index.css" />
	</head>
	<body>
		<div id="root">Loading...</div>
		<script type="module" src="/dist/index.js"></script>
	</body>
</html>


================================================================================
Content from: index (5).html
================================================================================

<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>LLM Chat App</title>
		<style>
			:root {
				--primary-color: #f6821f;
				--primary-hover: #e67e22;
				--light-bg: #f9fafb;
				--border-color: #e5e7eb;
				--text-color: #1f2937;
				--text-light: #6b7280;
				--user-msg-bg: #fff2e6;
				--assistant-msg-bg: #f3f4f6;
			}

			* {
				box-sizing: border-box;
				margin: 0;
				padding: 0;
			}

			body {
				font-family:
					-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu,
					Cantarell, sans-serif;
				line-height: 1.6;
				color: var(--text-color);
				max-width: 800px;
				margin: 0 auto;
				padding: 1rem;
			}

			header {
				text-align: center;
				margin-bottom: 2rem;
				padding: 1rem 0;
				border-bottom: 1px solid var(--border-color);
			}

			h1 {
				font-size: 1.5rem;
				color: var(--primary-color);
			}

			.chat-container {
				display: flex;
				flex-direction: column;
				height: calc(100vh - 200px);
				min-height: 400px;
				border: 1px solid var(--border-color);
				border-radius: 8px;
				overflow: hidden;
			}

			.chat-messages {
				flex: 1;
				overflow-y: auto;
				padding: 1rem;
				background-color: var(--light-bg);
			}

			.message {
				margin-bottom: 1rem;
				padding: 0.75rem;
				border-radius: 8px;
				max-width: 80%;
			}

			.user-message {
				background-color: var(--user-msg-bg);
				align-self: flex-end;
				margin-left: auto;
			}

			.assistant-message {
				background-color: var(--assistant-msg-bg);
				align-self: flex-start;
			}

			.message-input {
				display: flex;
				padding: 0.75rem;
				border-top: 1px solid var(--border-color);
				background-color: white;
			}

			#user-input {
				flex: 1;
				padding: 0.75rem;
				border: 1px solid var(--border-color);
				border-radius: 4px;
				font-family: inherit;
				resize: none;
				min-height: 44px;
			}

			#send-button {
				margin-left: 0.5rem;
				padding: 0 1rem;
				background-color: var(--primary-color);
				color: white;
				border: none;
				border-radius: 4px;
				cursor: pointer;
				transition: background-color 0.2s;
			}

			#send-button:hover {
				background-color: var(--primary-hover);
			}

			#send-button:disabled {
				background-color: var(--text-light);
				cursor: not-allowed;
			}

			.typing-indicator {
				display: none;
				margin-bottom: 1rem;
				font-style: italic;
				color: var(--text-light);
			}

			.typing-indicator.visible {
				display: block;
			}

			footer {
				margin-top: 1rem;
				text-align: center;
				font-size: 0.85rem;
				color: var(--text-light);
			}
		</style>
	</head>
	<body>
		<header>
			<h1>Cloudflare AI Chat</h1>
			<p>Powered by Cloudflare Workers AI</p>
		</header>

		<div class="chat-container">
			<div id="chat-messages" class="chat-messages">
				<div class="message assistant-message">
					<p>
						Hello! I'm an LLM chat app powered by Cloudflare Workers AI. How can
						I help you today?
					</p>
				</div>
			</div>

			<div class="typing-indicator" id="typing-indicator">
				AI is thinking...
			</div>

			<div class="message-input">
				<textarea
					id="user-input"
					placeholder="Type your message here..."
					rows="1"
					autofocus
				></textarea>
				<button id="send-button">Send</button>
			</div>
		</div>

		<footer>
			<p>Cloudflare Workers AI Chat Template &copy; 2025</p>
		</footer>

		<!-- Chat app script -->
		<script src="chat.js"></script>
	</body>
</html>


================================================================================
Content from: index (6).html
================================================================================

<!doctype html>
<html lang="en">
	<head>
		<!-- Basic Page Needs
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
		<meta charset="utf-8" />
		<title>Chat!</title>
		<meta name="description" content="" />
		<meta name="author" content="" />

		<!-- Mobile Specific Metas
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
		<meta name="viewport" content="width=device-width, initial-scale=1" />

		<!-- FONT
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->

		<!-- CSS
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
		<link rel="stylesheet" href="css/normalize.css" />
		<link rel="stylesheet" href="css/skeleton.css" />
		<link rel="stylesheet" href="styles.css" />

		<!-- Favicon
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
		<link rel="icon" type="image/ico" href="favicon.ico" />
		<script src="/dist/index.js" type="module"></script>
	</head>
	<body>
		<!-- Primary Page Layout
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
		<div class="container" style="width: 95%; height: 100%">
			<div class="row" style="height: 100%">
				<div class="one-third column" style="margin-top: 25%">
					<h4><b>Chat</b>, powered by Durable Objects</h4>
					<p>
						This chat room is hosted in a single Durable Object, running in one
						process in one machine in one location, very close to the users.
					</p>
				</div>
				<div class="two-thirds column" id="root"></div>
			</div>
		</div>

		<!-- End Document
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
	</body>
</html>


================================================================================
Content from: index (7).html
================================================================================

<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>D1 Sessions API</title>
		<link
			rel="stylesheet"
			href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.red.min.css"
		/>
		<meta name="color-scheme" content="light dark" />
		<script type="module">
			import { h, render } from "https://esm.sh/preact@10.25.4";
			import {
				useState,
				useEffect,
				useRef,
			} from "https://esm.sh/preact@10.25.4/hooks";
			import htm from "https://esm.sh/htm@3.1.1";

			// Initialize htm with Preact
			const html = htm.bind(h);

			const fetchWorker = async (method, url, body, bookmark) => {
				const now = Date.now();
				return fetch(url, {
					method,
					body: body ? JSON.stringify(body) : undefined,
					headers: {
						"Content-Type": "application/json",
						"x-d1-bookmark": bookmark,
					},
				}).then((resp) => {
					return resp.json().then((json) => {
						if (!resp.ok) {
							console.error(`fetch failed with error: ${json.error}`);
						}
						if (!json.sessionBookmark) {
							json.sessionBookmark = resp.headers.get("x-d1-bookmark") ?? "";
						}
						return { ...json, browserLatency: Date.now() - now, now };
					});
				});
			};

			const highlightedRowStyle = {
				fontStyle: "italic",
				fontWeight: "bolder",
				border: "2px solid #D93526", // pico-color-red-500
			};

			const Latencies = ({
				d1Latency,
				browserLatency,
				servedByRegion,
				servedByPrimary,
			}) => {
				console.log({
					d1Latency,
					browserLatency,
					servedByRegion,
					servedByPrimary,
				});
				if (!d1Latency || !browserLatency) {
					return null;
				}
				return html`
					<section>
						<h4>Request metadata</h4>
						<dl class="grid">
							<div>
								<dt>D1 Latency RTT (Worker ➜ D1 Database)</dt>
								<dd>${Number(d1Latency).toFixed(0)}ms</dd>
							</div>

							<div>
								<dt>E2E Latency RTT (Browser ➜ Worker ➜ D1 Database)</dt>
								<dd>${Number(browserLatency).toFixed(0)}ms</dd>
							</div>

							${servedByRegion
								? html`
										<div>
											<dt>Served by Region</dt>
											<dd>
												${servedByRegion.toUpperCase()}
												(${servedByPrimary ? "primary" : "replica"})
											</dd>
										</div>
									`
								: null}
						</dl>
					</section>
				`;
			};

			const Demo1 = () => {
				const containerRef = useRef(null);
				const mutRef = useRef({});
				const [primaryRegion, setPrimaryRegion] = useState(null);
				const [result, setResult] = useState(null);

				const listOrders = () => {
					const bookmark = result
						? result.sessionBookmark
						: "first-unconstrained";
					fetchWorker("GET", "/api/orders", null, bookmark).then((json) => {
						if (
							(mutRef.bookmark ?? "").localeCompare(json.sessionBookmark) > 0
						) {
							// Skip any update since it's an older bookmark than the current one.
							return;
						}
						mutRef.bookmark = json.sessionBookmark;
						setResult(json);
					});
				};

				const createOrder = () => {
					const bookmark = mutRef.bookmark ?? "first-unconstrained";
					fetchWorker(
						"POST",
						"/api/orders",
						{
							customerId: containerRef.current.querySelector(
								"input[name='customerId']",
							).value,
							orderId: crypto.randomUUID(),
							quantity: Math.ceil(Math.random() * 100),
						},
						bookmark,
					).then((json) => {
						if (
							(mutRef.bookmark ?? "").localeCompare(json.sessionBookmark) > 0
						) {
							// Skip any update since it's an older bookmark than the current one.
							return;
						}
						mutRef.bookmark = json.sessionBookmark;
						setResult(json);
					});
				};

				const resetTables = () => {
					const bookmark = mutRef.bookmark ?? "first-unconstrained";
					fetchWorker("POST", "/api/reset", null, bookmark).then((json) => {
						setResult(json);
					});
				};

				useEffect(async () => {
					const json = await fetchWorker(
						"GET",
						"/api/orders",
						null,
						"first-primary",
					);
					setPrimaryRegion(json.servedByRegion);
					if ((mutRef.bookmark ?? "").localeCompare(json.sessionBookmark) > 0) {
						// Skip any update since it's an older bookmark than the current one.
						return;
					}
					mutRef.bookmark = json.sessionBookmark;
					setResult(json);
				}, []);

				console.log(result);

				return html`
					<div ref=${containerRef}>
						<section>
							<h4>Actions</h4>
							<div class="grid">
								<input name="customerId" value="customer-id-1" type="text" />
								<input
									type="button"
									onClick=${(e) => createOrder()}
									value="Create order & List"
								/>
								<input
									type="button"
									onClick=${(e) => listOrders()}
									value="List orders"
								/>
								<input
									type="button"
									onClick=${(e) => resetTables()}
									value="Reset"
								/>
							</div>
							<ul style="font-size: 0.8em">
								<li>
									<strong>Create order & List:</strong> 1 write query to the
									primary followed by 1 read query to a replica.
								</li>
								<li>
									<strong>List orders:</strong> 1 read query to a replica.
								</li>
								<li><strong>Reset:</strong> 1 write query to the primary.</li>
								${primaryRegion
									? html`<li>
											<strong>Primary database region:</strong> ${primaryRegion}
										</li>`
									: null}
							</ul>
						</section>

						<${Latencies} ...${result} />

						<section id="rows">
							<h4>Orders</h4>
							<div class="overflow-auto">
								<table class="striped">
									<thead>
										<tr>
											<th scope="col">Customer ID</th>
											<th scope="col">Order ID</th>
											<th>Quantity</th>
										</tr>
									</thead>
									<tbody>
										${!Array.isArray(result?.results)
											? html`<tr>
													<td colspan="3">
														Use the buttons above to load existing orders or
														create new ones.
													</td>
												</tr>`
											: result.results.length > 0
												? result.results.reverse().map((row, idx) => {
														return html`<tr key=${`${row.now}`}>
															<td>${row.customerId}</td>
															<td>${row.orderId}</td>
															<td>${row.quantity}</td>
														</tr>`;
													})
												: html`<tr>
														<td colspan="3">No orders yet.</td>
													</tr>`}
									</tbody>
								</table>
							</div>
						</section>
					</div>
				`;
			};

			const Demos = () => {
				return html`
					<div>
						<section>
							<header class="grid">
								<h1>D1 Sessions API</h1>
							</header>
						</section>

						<section><${Demo1} /></section>

						<hr />

						<small
							>(<a
								href="https://github.com/cloudflare/templates/tree/main/d1-starter-sessions-api-template"
								target="_blank"
								>Demo source code</a
							>)</small
						>
					</div>
				`;
			};

			render(html`<${Demos} />`, document.getElementById("app"));
		</script>
	</head>

	<body>
		<main class="container-fluid" id="app"></main>
	</body>
</html>
